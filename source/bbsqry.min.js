var Query=function(){var b={btn:null};var a={user:"TA",item:{d:"",v:0}};var h={src:"http://zhainan.lightory.net/"};var g=function(m){if(m.d==""){return""}var j=m.d.split(",");var k=_getcookie("_U_UID");if(m.v==1){for(var l=0;l<j.length;l++){if(j[l]==k){j.splice(l,1);break}}switch(j.length){case 0:return _tmpl("我觉得<%=type%>靠谱",{type:a.user});case 1:return _tmpl("我和 <%=u1%> 都觉得<%=type%>靠谱",{u1:j[0],type:a.user});default:return _tmpl('我和其他 <a href="###" onclick="return false;" class="like_style" title="<%=title%>"><%=count%>人</a> 都觉得<%=type%>靠谱',{count:j.length,type:a.user,title:m.d})}}switch(j.length){case 0:return"";case 1:return _tmpl("<%=u1%> 觉得<%=type%>靠谱",{u1:j[0],type:a.user});case 2:return _tmpl("<%=u1%> 和 <%=u2%> 都觉得<%=type%>靠谱",{u1:j[0],u2:j[1],type:a.user});default:return _tmpl('<%=u1%> 等 <a href="###" onclick="return false;" class="like_style" title="<%=title%>"><%=count%>人</a> 都觉得<%=type%>靠谱',{u1:j[0],count:j.length,type:a.user,title:m.d})}};var d=function(){var i=_getcookie("_U_UID");jq.ajax({url:[h.src,"sgr?u=",i,"&i=",a.user].join(""),dataType:"jsonp",jsonp:"jsonpcallback",success:function(j){if(j.length>0){a.item=j[0];e()}}})};var e=function(){var i=jq(".like_button:eq(0)");var j=jq(".like_desc:eq(0)");i.show();if(a.item.v==1){i.addClass("liked");i.html('<i class="sp_like"></i>已赞');j.html(g(a.item))}else{i.removeClass("liked");i.html('<i class="sp_like"></i>赞一个');j.html(g(a.item))}};var f=function(){var i=/([a-zA-Z0-9]+) \((.*)\) 共上站 \d+ 次/ig.exec(jq("pre:eq(0)").text());if(i){a.user=i[1];var m=jq(".c37:eq(2)");var k=[" 篇",'<span class="like_button hide" onclick="mbbs.togglelike(this)"><i class="sp_like"></i>赞一个</span><span class="like_desc"></span>',"\n["];var l=jq("<div></div>");l.append(m.children());m.html(k);m.append(l.children());d();var j=['<style type="text/css">',".hide{display:none}",".like_desc{margin-left:5px;}",".like_button{margin-left:5px;background: #ECEEF5;border-radius: 3px;border: 1px solid #CAD4E7;cursor: pointer;padding: 2px 2px 2px;white-space: nowrap;color: #3B5998;}",".like_button:hover{border-color:#9dacce}",".like_button.liked{background-color: #EEE;border-color: #DDD;color: #AAA;}",".sp_like{background-image:url(http://bbs.nju.edu.cn/file/W/Warrior/like.png);background-repeat:no-repeat;display:inline-block;height:14px;width:14px;background-position: -0px -45px;position: relative;top: 3px;margin-right: 3px;}",".like_button.liked:hover{border-color:#ccc}",".like_desc a.like_style{color:#3D6CBE}",".like_desc{color:#3D6CBE}",".like_button.liked .sp_like{background-position: -0px -15px;}",".like_button.liked:hover .sp_like{background-position: -0px -30px;}","</style>"].join("");jq("head").append(j)}};var c=function(l){var j=jq(l);var k="like";var i=_getcookie("_U_UID");if(i==""||a.user==""){alert("匆匆过客不能顶哦!请先登录~");return}if(j.hasClass("liked")){k="dislike"}jq.ajax({url:[h.src,"gr?a=",k,"&i=",a.user,"&u=",i].join(""),dataType:"jsonp",jsonp:"jsonpcallback",success:function(o){if(k=="like"){a.item.v=1;if(a.item.d==""){a.item.d=i}else{var m=a.item.d.split(",");m.push(i);a.item.d=m.join(",")}}else{a.item.v=0;var m=a.item.d.split(",");for(var n=0;n<m.length;n++){if(m[n]==i){m.splice(n,1);break}}a.item.d=m.join(",")}e()}})};return{init:f,togglelike:c}};jq(function(){var a=new Query();window.mbbs=a;a.init()});